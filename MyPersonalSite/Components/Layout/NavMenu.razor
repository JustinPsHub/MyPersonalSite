@implements IDisposable
@inject NavigationManager NavManager

<nav class="menu-nav" aria-label="Site navigation">
    @if (!_isOnHome)
    {
        <NavLink href="/" Match="NavLinkMatch.All" class="nav-link menu-link" data-bs-dismiss="offcanvas">Home</NavLink>
    }
    <NavLink href="/resume" class="nav-link menu-link" data-bs-dismiss="offcanvas">Resume</NavLink>
    <NavLink href="/visuals" class="nav-link menu-link" data-bs-dismiss="offcanvas">Visuals</NavLink>
</nav>

@code {
    private bool _isOnHome;

    protected override void OnInitialized()
    {
        _isOnHome = IsHome(NavManager.Uri);
        NavManager.LocationChanged += HandleLocationChanged;
    }

    private void HandleLocationChanged(object? sender, LocationChangedEventArgs args)
    {
        var isHome = IsHome(args.Location);
        if (isHome != _isOnHome)
        {
            _isOnHome = isHome;
            _ = InvokeAsync(StateHasChanged);
        }
    }

    private bool IsHome(string uri)
    {
        var relative = NavManager.ToBaseRelativePath(uri);
        if (string.IsNullOrEmpty(relative))
        {
            return true;
        }

        return string.IsNullOrEmpty(relative.Trim('/'));
    }

    public void Dispose()
    {
        NavManager.LocationChanged -= HandleLocationChanged;
    }
}
