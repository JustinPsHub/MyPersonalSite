@implements IDisposable
@inject NavigationManager NavManager

<div class="menu-backdrop @(IsOpen ? "show" : string.Empty)" @onclick="CloseMenu" aria-hidden="true"></div>

<aside id="site-menu"
       class="menu-drawer @(IsOpen ? "open" : string.Empty)"
       role="navigation"
       aria-label="Main"
       aria-hidden="@(IsOpen ? "false" : "true")">
    <div class="menu-drawer__header">
        <a class="site-brand" href="/">Justin Palmer</a>
        <button type="button"
                class="menu-close"
                @onclick="CloseMenu"
                aria-label="Close menu">âœ•</button>
    </div>

    <nav class="menu-drawer__nav">
        <NavLink href="/" Match="NavLinkMatch.All" class="menu-link" @onclick="HandleLinkClick">Home</NavLink>
        <NavLink href="/resume" class="menu-link" @onclick="HandleLinkClick">Resume</NavLink>
        <NavLink href="/visuals" class="menu-link" @onclick="HandleLinkClick">Visuals</NavLink>
    </nav>
</aside>

@code {
    [Parameter]
    public bool IsOpen { get; set; }

    [Parameter]
    public EventCallback<bool> IsOpenChanged { get; set; }

    protected override void OnInitialized()
    {
        NavManager.LocationChanged += HandleLocationChanged;
    }

    private void HandleLocationChanged(object? sender, LocationChangedEventArgs args)
    {
        if (!IsOpen)
        {
            return;
        }

        _ = InvokeAsync(() => IsOpenChanged.InvokeAsync(false));
    }

    private Task HandleLinkClick(MouseEventArgs _) => CloseMenu();

    private Task CloseMenu()
    {
        if (!IsOpen)
        {
            return Task.CompletedTask;
        }

        return IsOpenChanged.InvokeAsync(false);
    }

    public void Dispose()
    {
        NavManager.LocationChanged -= HandleLocationChanged;
    }
}
