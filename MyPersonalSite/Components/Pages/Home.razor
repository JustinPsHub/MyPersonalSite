@page "/"
@rendermode InteractiveServer
@inject IHttpClientFactory HttpFactory
@inject NavigationManager Nav
@inject IJSRuntime JS

<PageTitle>Justin • .NET / Blazor / Data</PageTitle>

<div class="home-page">
    <!-- HERO -->
    <div class="hero-gradient home-hero hero-photo">
        <picture class="hero-bg">
            <source type="image/avif"
                    srcset='@Assets["img/hero-farm-tech-800.avif"] 800w,
                            @Assets["img/hero-farm-tech-1200.avif"] 1200w,
                            @Assets["img/hero-farm-tech-1600.avif"] 1600w'
                    sizes="(max-width: 576px) 100vw, (max-width: 992px) 92vw, 1200px" />
            <source type="image/webp"
                    srcset='@Assets["img/hero-farm-tech-800.webp"] 800w,
                            @Assets["img/hero-farm-tech-1200.webp"] 1200w,
                            @Assets["img/hero-farm-tech-1600.webp"] 1600w'
                    sizes="(max-width: 576px) 100vw, (max-width: 992px) 92vw, 1200px" />
            <img src='@Assets["img/hero-farm-tech.png"]'
                 alt="Farmhouse with dog and tech overlay"
                 loading="eager" decoding="async" fetchpriority="high" />
        </picture>

        <div class="container py-4">
            <div class="row align-items-center g-3">
                <div class="col-lg-7">
                    <h1 class="hero-title text-white">I build secure, data-driven .NET apps.</h1>
                    <p class="lead-sm text-hero-muted mb-3">
                        16 yrs in federal service • 8 yrs data analyst/dev • Focused on
                        <strong>Blazor</strong>, <strong>C#</strong>, and <strong>data engineering</strong>.
                    </p>
                    <div class="d-flex flex-wrap gap-2">
                        <a class="btn btn-primary btn-md" href="/resume">View Resume</a>
                        <a class="btn btn-outline-light btn-md" href="/visuals">See D3 Visuals</a>
                        <a class="btn btn-outline-light btn-md" href="/about">About Me</a>
                        <button class="btn btn-outline-light btn-md ms-auto theme-toggle" @onclick="ToggleTheme">
                            @(_theme == "dark" ? "🌙 Dark" : "☀️ Light")
                        </button>
                    </div>
                </div>

                <div class="col-lg-5">
                    <div class="glass compact hero-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h2 class="h6 mb-0 text-muted">Live site stats</h2>
                            <span class="badge bg-light text-dark">EF Core</span>
                        </div>

                        @if (_stats is null)
                        {
                            <div class="d-flex gap-4 flex-wrap">
                                <div class="mini-stat"><div class="placeholder col-6 mb-1" style="height:24px"></div><div class="mini-label">Resume entries</div></div>
                                <div class="mini-stat"><div class="placeholder col-6 mb-1" style="height:24px"></div><div class="mini-label">Sections</div></div>
                                <div class="mini-stat"><div class="placeholder col-6 mb-1" style="height:24px"></div><div class="mini-label">Items</div></div>
                            </div>
                        }
                        else
                        {
                            <div class="d-flex gap-4 flex-wrap">
                                <div class="mini-stat"><div id="stat-entries" class="mini-value">@_stats.entries</div><div class="mini-label">Resume entries</div></div>
                                <div class="mini-stat"><div id="stat-sections" class="mini-value">@_stats.sections</div><div class="mini-label">Sections</div></div>
                                <div class="mini-stat"><div id="stat-items" class="mini-value">@_stats.items</div><div class="mini-label">Items</div></div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="clearfix d-block w-100"></div>

    <!-- BODY -->
    <div class="container py-4">
        <!-- At a glance -->
        <section class="section-tight mb-4">
            <h2 class="section-title mb-3">At a glance</h2>
            <div class="row g-3">
                <div class="col-md-4 reveal">
                    <div class="tile">
                        <div class="tile-title">Full-stack Blazor</div>
                        <div class="tile-text">Server + WASM interactivity, clean components, JS interop when it adds value.</div>
                        <div class="chips">
                            <span class="chip">C# / .NET 9</span><span class="chip">Blazor</span><span class="chip">Razor</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 reveal">
                    <div class="tile">
                        <div class="tile-title">Data engineering</div>
                        <div class="tile-text">Modeling, APIs, and making insight obvious with interactive visuals.</div>
                        <div class="chips">
                            <span class="chip">EF Core</span><span class="chip">SQL/SQLite</span><span class="chip">LINQ</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 reveal">
                    <div class="tile">
                        <div class="tile-title">Secure by default</div>
                        <div class="tile-text">HTTPS, antiforgery, validation/options, layered architecture.</div>
                        <div class="chips">
                            <span class="chip">Middleware</span><span class="chip">Options</span><span class="chip">Validation</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 reveal">
                <div class="tile">
                    <div class="tile-title">Automation & Security</div>
                    <div class="tile-text">
                        Own <strong>Power BI RLS</strong> security tables and refresh logic.
                        Automate with <strong>PowerShell</strong>, <strong>Power BI REST API</strong>, and <strong>Microsoft Graph</strong>.
                    </div>
                    <div class="chips">
                        <span class="chip">PowerShell</span><span class="chip">Power BI REST</span>
                        <span class="chip">Microsoft Graph</span><span class="chip">RLS</span>
                    </div>
                </div>
            </div>

        </section>

        <!-- NEW: Skills snapshot (mirrors resume groupings) -->
        <section class="section-tight mb-4">
            <h2 class="section-title mb-3">Skills snapshot</h2>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="tile h-100">
                        <div class="tile-title mb-1">Languages &amp; Frameworks</div>
                        <div class="chips">
                            @foreach (var s in SkillsLanguages)
                            {
                                <span class="chip">@s</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="tile h-100">
                        <div class="tile-title mb-1">Data &amp; BI</div>
                        <div class="chips">
                            @foreach (var s in SkillsDataBI)
                            {
                                <span class="chip">@s</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="tile h-100">
                        <div class="tile-title mb-1">Cloud &amp; DevOps</div>
                        <div class="chips">
                            @foreach (var s in SkillsCloudDevOps)
                            {
                                <span class="chip">@s</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="tile h-100">
                        <div class="tile-title mb-1">Visualization &amp; Interop</div>
                        <div class="chips">
                            @foreach (var s in SkillsVizInterop)
                            {
                                <span class="chip">@s</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="tile h-100">
                        <div class="tile-title mb-1">Security &amp; Ops</div>
                        <div class="chips">
                            @foreach (var s in SkillsSecOps)
                            {
                                <span class="chip">@s</span>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Featured -->
        <section class="section-tight mb-4">
            <h2 class="section-title mb-3">Featured</h2>
            <div class="row g-3">
                <div class="col-md-6 reveal">
                    <div class="card tile-card h-100">
                        <div class="card-body">
                            <div class="tile-title mb-1">Interactive Visuals</div>
                            <p class="tile-text mb-2">D3 + Blazor interop with EF Core data. Sorting, tooltips, responsive charts.</p>
                            <a class="btn btn-primary btn-sm" href="/visuals">Open Visuals</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 reveal">
                    <div class="card tile-card h-100">
                        <div class="card-body">
                            <div class="tile-title mb-1">Resume</div>
                            <p class="tile-text mb-2">Print-ready resume page (or PDF) backed by a clean data model.</p>
                            <a class="btn btn-outline-primary btn-sm" href="/resume">View Resume</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tech strip (kept) -->
        <section class="section-tight">
            <h2 class="section-title mb-2">Tech I use</h2>
            <div class="d-flex flex-wrap gap-2">
                @foreach (var t in Tech)
                {
                    <span class="chip">@t</span>
                }
            </div>
        </section>

        <!-- CTA -->
        <section class="mt-4">
            <div class="callout glass compact d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2 reveal">
                <div>
                    <h3 class="h6 mb-1">Let’s build something great.</h3>
                    <p class="mb-0 text-muted">Open to .NET/Blazor and data engineering roles.</p>
                </div>
                <div class="d-flex gap-2">
                    <a class="btn btn-primary btn-sm" href="/about">About Me</a>
                    <a class="btn btn-outline-primary btn-sm" href="/visuals">See Visuals</a>
                </div>
            </div>
        </section>
    </div>
</div>

@code {
    private sealed class DbStats { public int items { get; set; } public int sections { get; set; } public int entries { get; set; } }
    private DbStats? _stats;
    private bool _animated;
    private string _theme = "light";

    // New skills groupings (explicitly calling out your expertise areas)
    private static readonly string[] SkillsLanguages = new[]
    {
        "C# / .NET 9", "ASP.NET (Server & WASM)", "Razor / Blazor", "LINQ"
    };

    private static readonly string[] SkillsDataBI = new[]
    {
        "SQL Server", "SQLite", "EF Core", "SSIS",
        "Power BI Service", "Power BI Report Server",
        "SSMS", "Azure Data Studio",
        "Dimensional Modeling", "DAX"
    };

    private static readonly string[] SkillsCloudDevOps = new[]
    {
        "Azure", "Azure DevOps (Repos/Boards/Wikis/Pipelines)", "CI/CD",
        "Azure Data Factory (ELT)", "Azure Functions (.NET)"
    };

    private static readonly string[] SkillsVizInterop = new[]
    {
        "D3.js Interop", "JavaScript", "Blazor JS interop"
    };

    private static readonly string[] SkillsSecOps = new[]
    {
        "Security Headers / CSP", "Rate Limiting", "Health Checks",
        "RLS (Power BI)", "Python & Data Science Env Mgmt"
    };

    // Existing “Tech I use” strip
    private static readonly string[] Tech = new[]
    {
        "C# / .NET 9", "Blazor (Server + WASM)", "ASP.NET Razor", "EF Core", "SQL Server",
        "SQLite", "REST / Minimal APIs", "LINQ", "D3.js interop", "Power BI (Service/RS)",
        "SSIS", "JavaScript", "Azure", "Azure DevOps (Repos/Boards/Wikis/Pipelines)",
        "CI/CD", "Options/Config", "Security (CSP/Headers/RateLimits)",
        "Azure Data Factory (ELT)", "Azure Functions (.NET)", "SSMS", "Azure Data Studio",
        "Python Env Management","PowerShell", "Power BI REST API", "Microsoft Graph", "Azure Functions",
"Azure Data Factory (ELT)", "SSMS", "Azure Data Studio", "Row-Level Security (RLS)"

    };

    protected override async Task OnInitializedAsync()
    {
        try
        {
            using var http = HttpFactory.CreateClient();
            var uri = new Uri(new Uri(Nav.BaseUri), "api/debug/db-stats");
            _stats = await http.GetFromJsonAsync<DbStats>(uri);
        }
        catch { }

        try { _theme = await JS.InvokeAsync<string>("site.getTheme"); } catch { _theme = "light"; }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                await JS.InvokeVoidAsync("site.initTheme");
                await JS.InvokeVoidAsync("site.revealOnScroll");
            }
            catch { }
        }

        if (!_animated && _stats is not null)
        {
            try
            {
                await JS.InvokeVoidAsync("site.animateCount", "#stat-entries", _stats.entries);
                await JS.InvokeVoidAsync("site.animateCount", "#stat-sections", _stats.sections);
                await JS.InvokeVoidAsync("site.animateCount", "#stat-items", _stats.items);
            }
            catch { }
            _animated = true;
        }
    }

    private async Task ToggleTheme()
    {
        _theme = _theme == "dark" ? "light" : "dark";
        try { await JS.InvokeVoidAsync("site.setTheme", _theme); } catch { }
    }
}
